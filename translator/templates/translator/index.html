{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASL Lite â€” Detector</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f0f0;
      color: #333;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #333;
      color: white;
      padding: 20px;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
    }

    .nav a {
      color: white;
      text-decoration: none;
      padding: 0 15px;
      font-size: 18px;
    }

    .nav a:hover {
      text-decoration: underline;
    }

    .controls {
      display: flex;
      align-items: center;
    }

    .toggle {
      background: transparent;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    .container {
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background-color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .video-box {
      text-align: center;
      margin-bottom: 30px;
    }

    #video {
      max-width: 100%;
      height: auto;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    .action-buttons button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .action-buttons button:hover {
      background-color: #0056b3;
    }

    .translation, .translated {
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      background-color: #333;
      color: white;
    }

    footer a {
      color: white;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header class="header card">
    <div class="brand"><div class="logo">A</div><div>ASL Lite</div></div>
    <nav class="nav" aria-label="Main Navigation">
      <a href="{% url 'home' %}">Home</a>
      <a href="{% url 'learn_asl' %}">Learn ASL</a>
      <a href="{% url 'about' %}">About Us</a>
      <a href="{% url 'asl' %}">Try Detector</a>
    </nav>
    <div class="controls">
      <button class="toggle" id="theme-toggle" aria-label="Toggle theme">ðŸŒ—</button>
    </div>
  </header>

  <main class="container">
    <div class="card video-box">
      <h1>ASL Translator</h1>
      <video id="video" autoplay playsinline style="transform: scaleX(-1);" width="640" height="480"></video>
      <p id="translation" class="translation">Translation: </p>

      <div class="action-buttons">
        <button id="btn-en">Translate to English</button>
        <button id="btn-tl">Translate to Tagalog</button>
        <button id="btn-tts">Text to Speech</button>
        <button id="btn-backspace">Backspace</button>
      </div>

      <p id="translated" class="translated">Translated: </p>
    </div>

    <footer class="footer card">
      <div>Â© ASL Lite â€” Translate ASL in real time. Your video stays local.</div>
    </footer>
  </main>

  <script>
    // WebSocket setup
    const isLocal = window.location.hostname === 'localhost';  // Check if we're running locally
    const socketUrl = isLocal ? 'ws://localhost:8000/ws/translate/' : 'wss://your-app-name.onrender.com/ws/translate/';
    const socket = new WebSocket(socketUrl);

    // ASL Detection Logic and Button Actions
    // Same logic as you provided, just replace localhost with dynamic `socketUrl`
    const video = document.getElementById('video');
    const translation = document.getElementById('translation');

    navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480, frameRate: { max: 10 } } })
      .then(stream => {
        video.srcObject = stream;
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        setInterval(() => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          const dataURL = canvas.toDataURL('image/jpeg');
          socket.send(JSON.stringify({ image: dataURL, type: 'image', data: 'aha' }));
        }, 150);
      });

    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (msg.type === 'translated') {
        document.getElementById('translated').innerText = "Translated: " + msg.text;
      } else if (msg.type === 'translation_update') {
        document.getElementById('translation').innerText = "Translation: " + msg.translation;
      }
    };

    // Button Actions for Translate
    document.getElementById('btn-en').addEventListener('click', () => socket.send(JSON.stringify({ type: 'english', data: 'english' })));
    document.getElementById('btn-tl').addEventListener('click', () => socket.send(JSON.stringify({ type: 'tagalog', data: 'tagalog' })));
    document.getElementById('btn-tts').addEventListener('click', () => alert("Text to Speech functionality will be added."));
    document.getElementById('btn-backspace').addEventListener('click', () => socket.send(JSON.stringify({ type: 'X', data: 'X' })));
  </script>
</body>
</html>
