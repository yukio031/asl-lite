{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ASL Lite â€” Detector</title>
  <style>
    /* Same style as your original code */
  </style>
</head>
<body>
  <header class="header card">
    <div class="brand"><div class="logo">A</div><div>ASL Lite</div></div>
    <nav class="nav" aria-label="Main Navigation">
      <a href="{% url 'home' %}">Home</a>
      <a href="{% url 'learn_asl' %}">Learn ASL</a>
      <a href="{% url 'about' %}">About Us</a>
      <a href="{% url 'asl' %}">Try Detector</a>
    </nav>
    <div class="controls">
      <button class="toggle" id="theme-toggle" aria-label="Toggle theme">ðŸŒ—</button>
    </div>
  </header>

  <main class="container">
    <div class="card video-box">
      <h1>ASL Translator</h1>
      <video id="video" autoplay playsinline style="transform: scaleX(-1);" width="640" height="480"></video>
      <p id="translation" class="translation">Translation: </p>

      <div class="action-buttons">
        <button id="btn-en">Translate to English</button>
        <button id="btn-tl">Translate to Tagalog</button>
        <button id="btn-tts">Text to Speech</button>
        <button id="btn-backspace">Backspace</button>
      </div>

      <p id="translated" class="translated">Translated: </p>
    </div>

    <footer class="footer card">
      <div>Â© ASL Lite â€” Translate ASL in real time. Your video stays local.</div>
    </footer>
  </main>

  <script>
    // WebSocket setup
    const isLocal = window.location.hostname === 'localhost';  // Check if we're running locally
    const socketUrl = isLocal ? 'ws://localhost:8000/ws/translate/' : 'wss://your-app-name.onrender.com/ws/translate/';
    const socket = new WebSocket(socketUrl);

    // ASL Detection Logic and Button Actions
    // Same logic as you provided, just replace localhost with dynamic `socketUrl`
    const video = document.getElementById('video');
    const translation = document.getElementById('translation');

    navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480, frameRate: { max: 10 } } })
      .then(stream => {
        video.srcObject = stream;
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        setInterval(() => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          context.drawImage(video, 0, 0, canvas.width, canvas.height);
          const dataURL = canvas.toDataURL('image/jpeg');
          socket.send(JSON.stringify({ image: dataURL, type: 'image', data: 'aha' }));
        }, 150);
      });

    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (msg.type === 'translated') {
        document.getElementById('translated').innerText = "Translated: " + msg.text;
      } else if (msg.type === 'translation_update') {
        document.getElementById('translation').innerText = "Translation: " + msg.translation;
      }
    };

    // Button Actions for Translate
    document.getElementById('btn-en').addEventListener('click', () => socket.send(JSON.stringify({ type: 'english', data: 'english' })));
    document.getElementById('btn-tl').addEventListener('click', () => socket.send(JSON.stringify({ type: 'tagalog', data: 'tagalog' })));
    document.getElementById('btn-tts').addEventListener('click', () => alert("Text to Speech functionality will be added."));
    document.getElementById('btn-backspace').addEventListener('click', () => socket.send(JSON.stringify({ type: 'X', data: 'X' })));
  </script>
</body>
</html>
